------------------------------------------------------------------------

                        master.lib version 0.22
                          BGM / EFS マニュアル
                        原典:bgmlib.man by femy
                             改訂:steelman

------------------------------------------------------------------------

● 曲演奏機能

        　BGMデータは最大 16曲まで登録可能です。ただし曲バッファ
        が溢れない限りで、という制限つきです。
        　また演奏中に自由にテンポを変えることができます。ゲーム
        用にはこれぐらいできなきゃね〜って別に簡単なことなんだけ
        ど。

  ○ BGMファイル

        　BGMファイルはマイクロソフト系ベーシックの MML のサブセ
        ットとなっています。
        　曲データは読み込まれた順に曲番号 1,2,3,…,16  が付きま
        す。

  (1)MMLコマンド

    1.音程(A,B,C,D,E,F,G),半音(+,#,-)

        　A〜G  で音程を表します。 対応は   C=ド,D=レ,…,G=ソ,A=
        ラ,B=シ のようになっています。
        　半音は A〜G の後に、シャープなら +(or #)、フラットなら
        - を付けて表します。
        　また、さらにこの後に 1〜32  までの整数を付けることで音
        長を設定することができます。  1 のときを最大とした音分数
        の逆数が値となります。つまりは 4分音符なら 4、16分音符な
        ら 16 ということです。
        　符点は数字の後に .(ピリオド)を付けることで表します。

    2.休符(R)

        　R で休符を表します。さらにこの後に 1〜32  までの整数を
        付けることで音長を設定することができます。

    3.音長(Ln : 初期値n=4)

        　Ln で音長を指定します。このコマンドから以降は n で指定
        した音長で演奏されます。
        　ただし、音程や休符の後に音長を指定しているときはその音
        (休符)だけその音長で演奏されます。

    4.オクターブ(On,<,> : 初期値n=4)

        　On でオクターブを指定します。n は 1〜8 の整数で、 基本
        周波数 440Hz の音をオクターブ4 のラと設定しています(つま
        りは正しい音出してるってことだにゃ)。
        　また、単に < を指定すると現在のオクターブから  1オクタ
        ーブ下がり、> を指定すると 1オクターブ上がります。

    5.テヌート(Nn : 初期値n=0)

        　Nn でテヌート効果の有無を指定します。n は 0 か 1 で、0
        でテヌート効果無し(音と音を区切る)、1 でテヌート効果有り
        (音と音を区切らない)となります。

  (2)書式

    1.楽譜

        　楽譜は (1) で解説した  MML表記のものをパートごとにカン
        マで区切って並べます。(3パートまで)

    2.テンポ(Tn : 初期値n=120)

        　Tn でテンポを指定します。 テンポはファンクションコール
        でも設定できるので、なるべくそちらを使うことをお勧めしま
        す。なぜなら、例えば楽譜データの先頭にテンポ指定があると、
        ゲームなどで演奏中にテンポを変化させていた場合に曲が先頭
        に戻ったとたんに強制的にテンポが元に戻ってしまうからです。

    3.コメント(;)

        　;(セミコロン)の後は次に改行がくるまでコメント文とみな
        され無視されます。

    4.メッセージ(")

        　"(ダブルクォーテーション)で囲まれた文字はデータロード
        時に標準出力に出力されます(禁止することもできます)。ただ
        しエスケープシーケンスはサポートしていません。またメッセ
        ージの最後には自動的に改行が付加されます。

    5.次曲(*)

        　*は1つの曲データがおわって、まだ次に曲があるときに行頭
        に入れます。
        　最後の曲の後には入れないでください。 あると1曲分無駄に
        なります。


● 効果音出力機能

        　最大 16種類までの効果音が登録可能で、 曲演奏と並列して
        登録されている効果音をどれでも自由に出力することができま
        す。
        　ゲームを作るにゃ効果音ぐらい出せなきゃなんねーべ、とい
        うことで付けました。でも曲演奏中に効果音を頻繁に出力する
        と曲が聴きづらくなっちゃうという現象が起こります。だって
        しょうがないぢゃない、しくしく。


  ○ EFSファイル

        　以下に述べる書式に準じた EFSファイルを読み込み、効果音
        を出力させることができます。

    1.データ

        　4ms毎の出力周波数を数値データで指定します。 データは効
        果音 1つにつき 256個(約 1秒)までで、データとデータの間は
        スペースや改行(ようは数字ぢゃない文字)で区切ります。デー
        タの範囲は  40〜無限大(嘘だよん unsigned long で取れる範
        囲なのだ)で、0 で 1つの効果音データの終わりを表します。

    2.データファイル

        　EFSファイルは (1) で解説した EFSデータを 1〜16個まで並
        べたものです。かといって、必ずしも 1つのファイルにまとめ
        なきゃいけないかというとそうでもなく(なんじゃそりゃ)、別
        に複数に分かれていても構いません。とにかく読み込んだ順番
        に効果音番号 1,2,3,…,16 が付きます。
        　それから、 ;(セミコロン)の後は次に改行がくるまでコメン
        ト文とみなされ無視されます。これは BGMファイルと同様です。
        ところがどっこいメッセージ出力はこちらにはありません。何
        となくいらねーんぢゃないかなぁと思って外しました。

[END OF BGM.MAN]
